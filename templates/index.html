<!doctype html>
<html lang="zh-CN" xmlns:th="https://www.thymeleaf.org">
  <head th:replace="~{module/head(title = ${site.title})}"> </head>

  <body>
    <header>
      <div
        class="mt-20 mb-20 flex flex-col items-center justify-center gap-8 sm:flex-row sm:gap-14"
      >
        <img
          th:src="${theme.config.general.avatar}"
          class="h-40 rounded-full filter-none"
          alt="Avatar"
        />

        <div class="flex flex-col items-center gap-5 font-mono">
          <div class="text-4xl" th:text="${site.title}"></div>

          <div class="text-center">
            <th:block th:each="item : ${theme?.config?.social?.socials}">
              <a class="text-black" th:href="@{${item.url}}">
                <span
                  class="iconify-large"
                  th:classappend="${{
                    'bilibili': 'icon-[mingcute--bilibili-line]',
                    'email': 'icon-[material-symbols--mail-outline-rounded]',
                    'facebook': 'icon-[mingcute--facebook-line]',
                    'github': 'icon-[mingcute--github-line]',
                    'instagram': 'icon-[mdi--instagram]',
                    'qq': 'icon-[mingcute--qq-line]',
                    'telegram': 'icon-[ri--telegram-line]',
                    'tiktok': 'icon-[mingcute--tiktok-line]',
                    'twitter': 'icon-[si--twitter-line]',
                    'youtube': 'icon-[mingcute--youtube-line]',
                    'weibo': 'icon-[icon-park-outline--weibo]',
                    'xiaohongshu': 'icon-[simple-icons--xiaohongshu]',
                    'zhihu': 'icon-[ri--zhihu-fill]'
                    }[item.name]}"
                ></span>
              </a>
            </th:block>
            <a
              class="text-black"
              th:if="${theme.config.general.rss == 1}"
              href="/rss.xml"
            >
              <span class="iconify-large icon-[heroicons--rss]"></span>
            </a>
          </div>

          <nav class="flex justify-center gap-3">
            <th:block th:with="menu = ${menuFinder.getPrimary()}">
              <th:block th:with="menuItems = ${menu.menuItems}">
                <a
                  class="index-nav"
                  th:each="menuItem : ${menuItems}"
                  th:href="@{${menuItem.status.href}}"
                  th:text="${menuItem.status.displayName}"
                  th:target="${menuItem.spec.target?.value}"
                >
                </a>
              </th:block>
            </th:block>

            <a class="index-nav" href="javascript:SearchWidget.open()">
              <span class="iconify icon-[fa-solid--search]"></span>
            </a>

            <button id="theme-toggle" class="index-nav" aria-label="Toggle dark mode">
              <span id="sun-icon" class="iconify icon-[ph--sun-fill]"></span>
              <span id="moon-icon" class="iconify icon-[ph--moon-fill] hidden"></span>
            </button>
          </nav>
        </div>
      </div>
    </header>

    <main th:fragment="postList" class="mx-auto max-w-[768px]">
      <div class="flex flex-col gap-5">
        <a
          th:each="post : ${posts.items}"
          th:href="@{${post.status.permalink}}"
          class="index-post-card hover:shadow-card text-black transition duration-300"
        >
          <img
            th:if="${!#strings.isEmpty(post.spec.cover)}"
            th:src="${post.spec.cover}"
            class="cover"
          />

          <div class="post mx-4 my-4 flex flex-col gap-2">
            <div
              th:text="${post.spec.title}"
              class="textc-primary font-serif font-semibold"
              style="font-size: 1.2rem"
            ></div>

            <div
              th:if="${#strings.isEmpty(post.spec.cover)}"
              th:text="${post.status.excerpt != null and #strings.length(post.status.excerpt) > 150} ? ${#strings.substring(post.status.excerpt, 0, 150)} + '...' : ${post.status.excerpt}"
              style="font-size: 0.9rem"
              class="text-gray"
            ></div>
            <div
              th:if="${!#strings.isEmpty(post.spec.cover)}"
              th:text="${post.status.excerpt != null and #strings.length(post.status.excerpt) > 80} ? ${#strings.substring(post.status.excerpt, 0, 80)} + '...' : ${post.status.excerpt}"
              style="font-size: 0.9rem"
              class="text-gray"
            ></div>

            <div
              class="flex items-center justify-between"
              style="font-size: 0.8rem"
            >
              <time
                th:text="${#dates.format(post.spec.publishTime, 'yyyy-MM-dd')}"
                class="text-gray"
              ></time>
            </div>
          </div>
        </a>
      </div>

      <th:block
        th:replace="~{module/pagination(component=${posts})}"
      ></th:block>
    </main>

    <footer th:replace="~{module/footer}"></footer>

    <script>
      // 外部链接在新窗口打开，这是在任何页面都需要的功能
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll("a[href^='https://']").forEach((link) => {
          link.setAttribute("target", "_blank");
          link.setAttribute("rel", "noopener");
        });
        
        // 确保 main.js 中的主题切换初始化函数被调用
        // main.js 中的 DOMContentLoaded 已经包含了 main.initThemeToggle()
        // 所以这里不需要重复调用了
      });
    </script>
  </body>
</html>
